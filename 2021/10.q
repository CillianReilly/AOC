input:read0`:10.txt

d:(")]}>"!"([{<")
f:{{x where not any 1 next\0b,1_{y~d x}prior x}/[x]}

// Part 1
sum(")]}>"!3 57 1197 25137)c:first each inter\:[;key d]f each input

// Part 2
floor med{{y+5*x}/[0,1+key[d]?reverse d?f x]}each input where null c
